<!DOCTYPE html>
<html lang="zh-CN">
<meta charset="utf-8">
<title>ç”µå­è®¡ç®—å™¨åˆé›†</title>
<style>
  *{box-sizing:border-box;font-family:system-ui, sans-serif;}
  body{max-width:480px;margin:0 auto;padding:20px;background:#f7f7fa;}
  .tabs{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
  .tab{flex:1;padding:12px;border:none;border-radius:12px;background:#eaeef5;font-size:15px;cursor:pointer;white-space:nowrap;}
  .tab.active{background:#4e6de7;color:white;}
  .card{background:white;padding:24px;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,0.08);}
  .calc-page{display:none;}
  .calc-page.active{display:block;}
  h2{margin:0 0 18px;color:#222;font-size:20px;}
  /* æç¤ºæ–‡å­—æ ·å¼ï¼Œä¸é¡µé¢é£æ ¼é€‚é… */
  .trigger-tip{color:#666;font-size:13px;margin:-10px 0 18px 0;line-height:1.5;padding-left:2px;}
  .row{margin:12px 0;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
  .label-wrap{width:110px;flex-shrink:0;}
  label{color:#444;font-size:14px;}
  .input-group{flex:1;display:flex;}
  .input-group input{flex:1;padding:10px;border:1px solid #ddd;border-right:none;border-radius:8px 0 0 8px;font-size:15px;}
  .input-group select{padding:10px;border:1px solid #ddd;border-radius:0 8px 8px 0;font-size:14px;background:#fff;}
  button{width:100%;padding:12px;background:#4e6de7;color:white;border:none;border-radius:8px;font-size:15px;margin-top:10px;cursor:pointer;}
  button:hover{background:#405bdb;}
  .result{margin-top:16px;padding:14px;background:#f5f7fa;border-radius:8px;font-size:15px;line-height:1.8;white-space:pre-line;}
  /* è‰²ç¯ç”µé˜»æ ·å¼ */
  .color-band{display:flex;gap:6px;margin:10px 0;flex-wrap:wrap;}
  .color-btn{width:40px;height:40px;border:2px solid #ccc;border-radius:6px;cursor:pointer;}
  .color-btn.active{border-color:#4e6de7;}
  /* çº¿å¾„æŸ¥è¯¢å™¨æ ·å¼ */
  .query-type{display:flex;gap:10px;margin:10px 0;}
  .query-btn{flex:1;padding:10px;border:1px solid #ddd;border-radius:8px;background:#f5f7fa;cursor:pointer;text-align:center;}
  .query-btn.active{background:#4e6de7;color:white;border-color:#4e6de7;}
</style>
<div class="tabs">
  <button class="tab active" onclick="showPage('divider')">ç”µé˜»åˆ†å‹</button>
  <button class="tab" onclick="showPage('lc')">LC è®¡ç®—</button>
  <button class="tab" onclick="showPage('rc')">RC æˆªæ­¢é¢‘ç‡</button>
  <button class="tab" onclick="showPage('ne555_astable')">NE555 æŒ¯è¡</button>
  <button class="tab" onclick="showPage('ne555_monostable')">NE555 å•ç¨³æ€</button>
  <button class="tab" onclick="showPage('resistor_color')">è‰²ç¯ç”µé˜»</button>
  <button class="tab" onclick="showPage('enamel_wire')">çº¿å¾„æŸ¥è¯¢</button>
</div>
<div class="card">
  <!-- ç”µé˜»åˆ†å‹ -->
  <div class="calc-page active" id="page-divider">
    <h2>ç”µé˜»åˆ†å‹è®¡ç®—å™¨</h2>
    <div class="row">
      <div class="label-wrap"><label>æ€»ç”µå‹ Uâ‚</label></div>
      <div class="input-group">
        <input type="number" id="dv_u1" step="any">
        <select id="dv_u1_unit"><option value="V">V</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>åˆ†å‹ç”µå‹ Uâ‚‚</label></div>
      <div class="input-group">
        <input type="number" id="dv_u2" step="any">
        <select id="dv_u2_unit"><option value="V">V</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ä¸Šç”µé˜» Râ‚</label></div>
      <div class="input-group">
        <input type="number" id="dv_r1" step="any">
        <select id="dv_r1_unit"><option value="Î©">Î©</option><option value="kÎ©" selected>kÎ©</option><option value="MÎ©">MÎ©</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ä¸‹ç”µé˜» Râ‚‚</label></div>
      <div class="input-group">
        <input type="number" id="dv_r2" step="any">
        <select id="dv_r2_unit"><option value="Î©">Î©</option><option value="kÎ©" selected>kÎ©</option><option value="MÎ©">MÎ©</option></select>
      </div>
    </div>
    <button onclick="calcDivider()">è®¡ç®—</button>
    <div class="result" id="dv_res"></div>
  </div>
  <!-- LC è®¡ç®—ï¼ˆé˜»æŠ—è®¡ç®—ï¼‰ -->
  <div class="calc-page" id="page-lc">
    <h2>LC è°æŒ¯è®¡ç®—å™¨ï¼ˆé˜»æŠ—è®¡ç®—ï¼‰</h2>
    <!-- é˜»æŠ—è®¡ç®—è§¦å‘æ¡ä»¶æç¤º -->
    <div class="trigger-tip">ğŸ’¡ é˜»æŠ—è®¡ç®—è§¦å‘ï¼šè¾“å…¥ã€ç”µå®¹+é¢‘ç‡ã€‘ç®—å®¹æŠ— | è¾“å…¥ã€ç”µæ„Ÿ+é¢‘ç‡ã€‘ç®—æ„ŸæŠ—</div>
    <div class="row">
      <div class="label-wrap"><label>ç”µæ„Ÿ L</label></div>
      <div class="input-group">
        <input type="number" id="lc_l" step="any">
        <select id="lc_l_unit"><option value="nH">nH</option><option value="Î¼H" selected>Î¼H</option><option value="mH">mH</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ç”µå®¹ C</label></div>
      <div class="input-group">
        <input type="number" id="lc_c" step="any">
        <select id="lc_c_unit"><option value="pF" selected>pF</option><option value="nF">nF</option><option value="Î¼F">Î¼F</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>é¢‘ç‡ f</label></div>
      <div class="input-group">
        <input type="number" id="lc_f" step="any">
        <select id="lc_f_unit"><option value="Hz">Hz</option><option value="kHz">kHz</option><option value="MHz" selected>MHz</option></select>
      </div>
    </div>
    <button onclick="calcLC()">è®¡ç®—</button>
    <div class="result" id="lc_res"></div>
  </div>
  <!-- RC æˆªæ­¢é¢‘ç‡ -->
  <div class="calc-page" id="page-rc">
    <h2>RC æˆªæ­¢é¢‘ç‡è®¡ç®—å™¨</h2>
    <div class="row">
      <div class="label-wrap"><label>ç”µé˜» R</label></div>
      <div class="input-group">
        <input type="number" id="rc_r" step="any">
        <select id="rc_r_unit"><option value="Î©">Î©</option><option value="kÎ©" selected>kÎ©</option><option value="MÎ©">MÎ©</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ç”µå®¹ C</label></div>
      <div class="input-group">
        <input type="number" id="rc_c" step="any">
        <select id="rc_c_unit"><option value="pF">pF</option><option value="nF" selected>nF</option><option value="Î¼F">Î¼F</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>æˆªæ­¢é¢‘ç‡ f</label></div>
      <div class="input-group">
        <input type="number" id="rc_f" step="any">
        <select id="rc_f_unit"><option value="Hz">Hz</option><option value="kHz" selected>kHz</option><option value="MHz">MHz</option></select>
      </div>
    </div>
    <button onclick="calcRC()">è®¡ç®—</button>
    <div class="result" id="rc_res"></div>
  </div>
  <!-- NE555 å¤šè°æŒ¯è¡å™¨ -->
  <div class="calc-page" id="page-ne555_astable">
    <h2>NE555 æŒ¯è¡é¢‘ç‡</h2>
    <div class="row">
      <div class="label-wrap"><label>ç”µé˜» Ræ€»</label></div>
      <div class="input-group">
        <input type="number" id="ne555_r" step="any">
        <select id="ne555_r_unit"><option value="Î©">Î©</option><option value="kÎ©" selected>kÎ©</option><option value="MÎ©">MÎ©</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ç”µå®¹ C</label></div>
      <div class="input-group">
        <input type="number" id="ne555_c" step="any">
        <select id="ne555_c_unit"><option value="pF">pF</option><option value="nF">nF</option><option value="Î¼F" selected>Î¼F</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>é¢‘ç‡ f</label></div>
      <div class="input-group">
        <input type="number" id="ne555_f" step="any">
        <select id="ne555_f_unit"><option value="Hz">Hz</option><option value="kHz" selected>kHz</option><option value="MHz">MHz</option></select>
      </div>
    </div>
    <button onclick="calcNE555_Astable()">è®¡ç®—</button>
    <div class="result" id="ne555_astable_res"></div>
  </div>
  <!-- NE555 å•ç¨³æ€ -->
  <div class="calc-page" id="page-ne555_monostable">
    <h2>NE555 å•ç¨³æ€</h2>
    <div class="row">
      <div class="label-wrap"><label>ç”µé˜» R</label></div>
      <div class="input-group">
        <input type="number" id="mono_r" step="any">
        <select id="mono_r_unit"><option value="Î©">Î©</option><option value="kÎ©" selected>kÎ©</option><option value="MÎ©">MÎ©</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>ç”µå®¹ C</label></div>
      <div class="input-group">
        <input type="number" id="mono_c" step="any">
        <select id="mono_c_unit"><option value="pF">pF</option><option value="nF">nF</option><option value="Î¼F" selected>Î¼F</option></select>
      </div>
    </div>
    <div class="row">
      <div class="label-wrap"><label>æ—¶é—´ t</label></div>
      <div class="input-group">
        <input type="number" id="mono_t" step="any">
        <select id="mono_t_unit"><option value="us">Î¼s</option><option value="ms" selected>ms</option><option value="s">s</option></select>
      </div>
    </div>
    <button onclick="calcNE555_Monostable()">è®¡ç®—</button>
    <div class="result" id="ne555_monostable_res"></div>
  </div>
  <!-- è‰²ç¯ç”µé˜»è®¡ç®—å™¨ -->
  <div class="calc-page" id="page-resistor_color">
    <h2>è‰²ç¯ç”µé˜»è®¡ç®—å™¨</h2>
    <div class="row">
      <div class="label-wrap"><label>è‰²ç¯æ•°</label></div>
      <select id="ring_type" onchange="updateRingUI()">
        <option value="4">4ç¯ç”µé˜»</option>
        <option value="5">5ç¯ç”µé˜»</option>
      </select>
    </div>
    <!-- 4ç¯ç”µé˜» -->
    <div id="ring_4">
      <div class="row">
        <div class="label-wrap"><label>ç¬¬1ç¯(æ•°å­—)</label></div>
        <div class="color-band" id="band1"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬2ç¯(æ•°å­—)</label></div>
        <div class="color-band" id="band2"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬3ç¯(å€ç‡)</label></div>
        <div class="color-band" id="band3"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬4ç¯(è¯¯å·®)</label></div>
        <div class="color-band" id="band4"></div>
      </div>
    </div>
    <!-- 5ç¯ç”µé˜» -->
    <div id="ring_5" style="display:none">
      <div class="row">
        <div class="label-wrap"><label>ç¬¬1ç¯(æ•°å­—)</label></div>
        <div class="color-band" id="band1_5"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬2ç¯(æ•°å­—)</label></div>
        <div class="color-band" id="band2_5"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬3ç¯(æ•°å­—)</label></div>
        <div class="color-band" id="band3_5"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬4ç¯(å€ç‡)</label></div>
        <div class="color-band" id="band4_5"></div>
      </div>
      <div class="row">
        <div class="label-wrap"><label>ç¬¬5ç¯(è¯¯å·®)</label></div>
        <div class="color-band" id="band5_5"></div>
      </div>
    </div>
    <button onclick="calcResistorColor()">è®¡ç®—é˜»å€¼</button>
    <div class="result" id="resistor_color_res"></div>
  </div>
  <!-- çº¿å¾„æŸ¥è¯¢ï¼ˆåŸæ¼†åŒ…çº¿ç”µæµæŸ¥è¯¢å™¨ï¼Œ25â„ƒæ¸©å‡ï¼‰ -->
  <div class="calc-page" id="page-enamel_wire">
    <h2>çº¿å¾„æŸ¥è¯¢(25â„ƒæ¸©å‡)</h2>
    <!-- æŸ¥è¯¢ç±»å‹åˆ‡æ¢ -->
    <div class="query-type">
      <div class="query-btn active" id="query_by_wire" onclick="switchQueryType('wire')">çº¿è§„/ç›´å¾„æŸ¥ç”µæµ</div>
      <div class="query-btn" id="query_by_current" onclick="switchQueryType('current')">ç”µæµæŸ¥çº¿è§„/ç›´å¾„</div>
    </div>
    <!-- çº¿è§„/ç›´å¾„æŸ¥ç”µæµ -->
    <div id="wire_to_current" style="display:block">
      <div class="row">
        <div class="label-wrap"><label>è¾“å…¥ç±»å‹</label></div>
        <select id="wire_input_type" onchange="switchWireInputType()">
          <option value="diameter">çº¿å¾„(mm)</option>
          <option value="awg">AWGçº¿è§„</option>
        </select>
      </div>
      <!-- çº¿å¾„è¾“å…¥ -->
      <div id="diameter_input" style="display:block">
        <div class="row">
          <div class="label-wrap"><label>æ¼†åŒ…çº¿å¾„</label></div>
          <div class="input-group">
            <input type="number" id="wire_diameter" step="0.01" placeholder="å¦‚0.5/1.0">
            <select><option value="mm">mm</option></select>
          </div>
        </div>
      </div>
      <!-- AWGçº¿è§„è¾“å…¥ -->
      <div id="awg_input" style="display:none">
        <div class="row">
          <div class="label-wrap"><label>AWGçº¿è§„</label></div>
          <div class="input-group">
            <input type="number" id="wire_awg" step="1" placeholder="å¦‚18/22/24" min=0 max=40>
            <select><option value="awg">AWG</option></select>
          </div>
        </div>
      </div>
      <button onclick="calcWireToCurrent()">æŸ¥è¯¢æ‰¿è½½ç”µæµ</button>
    </div>
    <!-- ç”µæµæŸ¥çº¿è§„/ç›´å¾„ -->
    <div id="current_to_wire" style="display:none">
      <div class="row">
        <div class="label-wrap"><label>å·¥ä½œç”µæµ</label></div>
        <div class="input-group">
          <input type="number" id="work_current" step="0.1" placeholder="å¦‚1.5/5/10">
          <select><option value="A">A</option></select>
        </div>
      </div>
      <button onclick="calcCurrentToWire()">æŸ¥è¯¢é€‚é…çº¿è§„</button>
    </div>
    <div class="result" id="enamel_wire_res"></div>
  </div>
</div>
<script>
  // åˆ‡æ¢é¡µé¢
  function showPage(page) {
    document.querySelectorAll('.calc-page').forEach(el => el.classList.remove('active'))
    document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'))
    document.getElementById('page-'+page).classList.add('active')
    event.target.classList.add('active')
  }
  // å–å€¼ + å•ä½
  function getVal(id) {
    const num = parseFloat(document.getElementById(id).value) || null;
    const unit = document.getElementById(id + '_unit').value;
    return { num, unit };
  }
  // ---------------------- ç”µé˜»åˆ†å‹ ----------------------
  function calcDivider() {
    const U1 = getVal('dv_u1');
    const U2 = getVal('dv_u2');
    const R1 = getVal('dv_r1');
    const R2 = getVal('dv_r2');
    const res = document.getElementById('dv_res');
    const known = [U1.num, U2.num, R1.num, R2.num].filter(x => x !== null).length;
    if (known !== 3) {
      res.textContent = "âš ï¸ è¯·å¡« 3 ä¸ªå·²çŸ¥å€¼ï¼Œç•™ç©º 1 ä¸ªå¾…æ±‚";
      return;
    }
    function r2ohm(r) {
      if (r.unit === 'Î©') return r.num;
      if (r.unit === 'kÎ©') return r.num * 1000;
      if (r.unit === 'MÎ©') return r.num * 1e6;
      return r.num;
    }
    const u1 = U1.num;
    const u2 = U2.num;
    const r1 = r2ohm(R1);
    const r2 = r2ohm(R2);
    let lines = [];
    if (u1 === null) {
      const val = u2 * (r1 + r2) / r2;
      lines.push(`Uâ‚ = ${val.toFixed(3)} V`);
    } else if (u2 === null) {
      const val = u1 * r2 / (r1 + r2);
      lines.push(`Uâ‚‚ = ${val.toFixed(3)} V`);
    } else if (R1.num === null) {
      const val = r2 * (u1 - u2) / u2;
      lines.push(`Râ‚ = ${(val/1000).toFixed(3)} kÎ©`);
    } else if (R2.num === null) {
      const val = (u2 * r1) / (u1 - u2);
      lines.push(`Râ‚‚ = ${(val/1000).toFixed(3)} kÎ©`);
    }
    res.textContent = lines.join('\n');
  }
  // ---------------------- LC è°æŒ¯ï¼ˆæ ¸å¿ƒï¼šé˜»æŠ—è‡ªåŠ¨è®¡ç®—ï¼‰ ----------------------
  function autoFreq(f) {
    if (f < 1e3) return `${f.toFixed(3)} Hz`;
    if (f < 1e6) return `${(f/1e3).toFixed(3)} kHz`;
    return `${(f/1e6).toFixed(3)} MHz`;
  }
  function autoInductance(L) {
    if (L < 1e-6) return `${(L*1e9).toFixed(3)} nH`;
    if (L < 1e-3) return `${(L*1e6).toFixed(3)} Î¼H`;
    return `${(L*1e3).toFixed(3)} mH`;
  }
  function autoCapacitance(C) {
    if (C < 1e-9) return `${(C*1e12).toFixed(3)} pF`;
    if (C < 1e-6) return `${(C*1e9).toFixed(3)} nF`;
    return `${(C*1e6).toFixed(3)} Î¼F`;
  }
  // å•ä½è½¬æ¢å·¥å…·å‡½æ•°
  function f2hz(num, unit) { return unit === 'kHz' ? num*1e3 : unit === 'MHz' ? num*1e6 : num; }
  function c2f(num, unit) { return unit === 'pF' ? num*1e-12 : unit === 'nF' ? num*1e-9 : num*1e-6; }
  function l2h(num, unit) { return unit === 'nH' ? num*1e-9 : unit === 'Î¼H' ? num*1e-6 : num*1e-3; }
  // é˜»æŠ—æ ¼å¼åŒ–ï¼ˆÎ©/kÎ©ï¼Œä¿ç•™3ä½å°æ•°ï¼‰
  function formatZ(z) { return z >= 1e3 ? `${(z/1e3).toFixed(3)} kÎ©` : `${z.toFixed(3)} Î©`; }
  function calcLC() {
    const L = getVal('lc_l');
    const C = getVal('lc_c');
    const F = getVal('lc_f');
    const res = document.getElementById('lc_res');
    const PI = Math.PI;
    let resStr = '', zStr = '';
    const hasL = L.num !== null && L.num > 0;
    const hasC = C.num !== null && C.num > 0;
    const hasF = F.num !== null && F.num > 0;
    const known = [hasL, hasC, hasF].filter(Boolean).length;
    // ç¬¬ä¸€æ­¥ï¼šè‡ªåŠ¨åˆ¤æ–­å¹¶è®¡ç®—é˜»æŠ—ï¼ˆæ¡ä»¶è¶³å¤Ÿæ‰æ˜¾ç¤ºï¼‰
    // ç”µå®¹+é¢‘ç‡ â†’ è®¡ç®—å®¹æŠ— Xc = 1/(2Ï€fC)
    if (hasC && hasF) {
      const Xc = 1 / (2 * PI * f2hz(F.num, F.unit) * c2f(C.num, C.unit));
      zStr = `å®¹æŠ— Xc = ${formatZ(Xc)}`;
    }
    // ç”µæ„Ÿ+é¢‘ç‡ â†’ è®¡ç®—æ„ŸæŠ— Xl = 2Ï€fL
    else if (hasL && hasF) {
      const Xl = 2 * PI * f2hz(F.num, F.unit) * l2h(L.num, L.unit);
      zStr = `æ„ŸæŠ— Xl = ${formatZ(Xl)}`;
    }
    // æ¡ä»¶ä¸è¶³ â†’ ä¸æ˜¾ç¤ºé˜»æŠ—
    // ç¬¬äºŒæ­¥ï¼šåŸæœ‰LCè°æŒ¯çŸ¥äºŒæ±‚ä¸€é€»è¾‘
    if (known === 2) {
      function convL(l) { return l2h(l.num, l.unit); }
      function convC(c) { return c2f(c.num, c.unit); }
      function convF(fq) { return f2hz(fq.num, fq.unit); }
      let realL, realC, realF;
      if (!hasF) {
        realL = convL(L); realC = convC(C);
        realF = 1 / (2 * PI * Math.sqrt(realL * realC));
        resStr = `è°æŒ¯é¢‘ç‡ f = ${autoFreq(realF)}`;
      } else if (!hasL) {
        realC = convC(C); realF = convF(F);
        realL = 1 / (4 * PI*PI * realF*realF * realC);
        resStr = `ç”µæ„Ÿ L = ${autoInductance(realL)}`;
      } else if (!hasC) {
        realL = convL(L); realF = convF(F);
        realC = 1 / (4 * PI*PI * realF*realF * realL);
        resStr = `ç”µå®¹ C = ${autoCapacitance(realC)}`;
      }
    } else if (known !== 0) {
      resStr = "âš ï¸ è¯·å¡« 2 ä¸ªå€¼ï¼Œç•™ç©º 1 ä¸ªå¾…æ±‚";
    }
    // æ‹¼æ¥ç»“æœï¼šè°æŒ¯ç»“æœ + é˜»æŠ—ç»“æœï¼ˆå¦‚æœ‰ï¼‰
    let finalStr = resStr;
    if (finalStr && zStr) finalStr += '\n' + zStr;
    else if (!finalStr) finalStr = zStr;
    res.textContent = finalStr;
  }
  // ---------------------- RC æˆªæ­¢é¢‘ç‡ ----------------------
  function calcRC() {
    const R = getVal('rc_r');
    const C = getVal('rc_c');
    const f = getVal('rc_f');
    const res = document.getElementById('rc_res');
    const known = [R.num, C.num, f.num].filter(x => x !== null).length;
    if (known !== 2) {
      res.textContent = "âš ï¸ è¯·å¡« 2 ä¸ªå€¼ï¼Œç•™ç©º 1 ä¸ªå¾…æ±‚";
      return;
    }
    function r2ohm(r) {
      if (r.unit === 'Î©') return r.num;
      if (r.unit === 'kÎ©') return r.num * 1000;
      if (r.unit === 'MÎ©') return r.num * 1e6;
      return r.num;
    }
    function c2farad(c) {
      if (c.unit === 'pF') return c.num * 1e-12;
      if (c.unit === 'nF') return c.num * 1e-9;
      if (c.unit === 'Î¼F') return c.num * 1e-6;
      return c.num;
    }
    function f2hz(fq) {
      if (fq.unit === 'Hz') return fq.num;
      if (fq.unit === 'kHz') return fq.num * 1e3;
      if (fq.unit === 'MHz') return fq.num * 1e6;
      return fq.num;
    }
    const PI = Math.PI;
    let realR, realC, realF;
    if (f.num === null) {
      realR = r2ohm(R);
      realC = c2farad(C);
      realF = 1 / (2 * PI * realR * realC);
    } else if (R.num === null) {
      realC = c2farad(C);
      realF = f2hz(f);
      realR = 1 / (2 * PI * realF * realC);
    } else if (C.num === null) {
      realR = r2ohm(R);
      realF = f2hz(f);
      realC = 1 / (2 * PI * realF * realR);
    }
    function autoR(r) {
      if (r < 1e3) return `${r.toFixed(3)} Î©`;
      if (r < 1e6) return `${(r/1e3).toFixed(3)} kÎ©`;
      return `${(r/1e6).toFixed(3)} MÎ©`;
    }
    function autoC(c) {
      if (c < 1e-9) return `${(c*1e12).toFixed(3)} pF`;
      if (c < 1e-6) return `${(c*1e9).toFixed(3)} nF`;
      return `${(c*1e6).toFixed(3)} Î¼F`;
    }
    function autoF(fq) {
      if (fq < 1e3) return `${fq.toFixed(3)} Hz`;
      if (fq < 1e6) return `${(fq/1e3).toFixed(3)} kHz`;
      return `${(fq/1e6).toFixed(3)} MHz`;
    }
    const lines = [
      `R = ${autoR(realR)}`,
      `C = ${autoC(realC)}`,
      `f = ${autoF(realF)}`
    ];
    res.textContent = lines.join('\n');
  }
  // ---------------------- NE555 å¤šè°æŒ¯è¡å™¨ ----------------------
  function calcNE555_Astable() {
    const R = getVal('ne555_r');
    const C = getVal('ne555_c');
    const f = getVal('ne555_f');
    const res = document.getElementById('ne555_astable_res');
    const known = [R.num, C.num, f.num].filter(x => x !== null).length;
    if (known !== 2) {
      res.textContent = "âš ï¸ è¯·å¡« 2 ä¸ªå€¼ï¼Œç•™ç©º 1 ä¸ªå¾…æ±‚";
      return;
    }
    function r2ohm(r) {
      if (r.unit === 'Î©') return r.num;
      if (r.unit === 'kÎ©') return r.num * 1000;
      if (r.unit === 'MÎ©') return r.num * 1e6;
      return r.num;
    }
    function c2farad(c) {
      if (c.unit === 'pF') return c.num * 1e-12;
      if (c.unit === 'nF') return c.num * 1e-9;
      if (c.unit === 'Î¼F') return c.num * 1e-6;
      return c.num;
    }
    function f2hz(fq) {
      if (fq.unit === 'Hz') return fq.num;
      if (fq.unit === 'kHz') return fq.num * 1e3;
      if (fq.unit === 'MHz') return fq.num * 1e6;
      return fq.num;
    }
    let realR, realC, realF;
    const k = 1.44;
    if (f.num === null) {
      realR = r2ohm(R);
      realC = c2farad(C);
      realF = k / (realR * realC);
    } else if (R.num === null) {
      realC = c2farad(C);
      realF = f2hz(f);
      realR = k / (realF * realC);
    } else if (C.num === null) {
      realR = r2ohm(R);
      realF = f2hz(f);
      realC = k / (realF * realR);
    }
    function autoR(r) {
      if (r < 1e3) return `${r.toFixed(3)} Î©`;
      if (r < 1e6) return `${(r/1e3).toFixed(3)} kÎ©`;
      return `${(r/1e6).toFixed(3)} MÎ©`;
    }
    function autoC(c) {
      if (c < 1e-9) return `${(c*1e12).toFixed(3)} pF`;
      if (c < 1e-6) return `${(c*1e9).toFixed(3)} nF`;
      return `${(c*1e6).toFixed(3)} Î¼F`;
    }
    function autoF(fq) {
      if (fq < 1e3) return `${fq.toFixed(3)} Hz`;
      if (fq < 1e6) return `${(fq/1e3).toFixed(3)} kHz`;
      return `${(fq/1e6).toFixed(3)} MHz`;
    }
    const lines = [
      `Ræ€» = ${autoR(realR)}`,
      `C = ${autoC(realC)}`,
      `f = ${autoF(realF)}`
    ];
    res.textContent = lines.join('\n');
  }
  // ---------------------- NE555 å•ç¨³æ€ ----------------------
  function calcNE555_Monostable() {
    const R = getVal('mono_r');
    const C = getVal('mono_c');
    const t = getVal('mono_t');
    const res = document.getElementById('ne555_monostable_res');
    const known = [R.num, C.num, t.num].filter(x => x !== null).length;
    if (known !== 2) {
      res.textContent = "âš ï¸ è¯·å¡« 2 ä¸ªå€¼ï¼Œç•™ç©º 1 ä¸ªå¾…æ±‚";
      return;
    }
    function r2ohm(r) {
      if (r.unit === 'Î©') return r.num;
      if (r.unit === 'kÎ©') return r.num * 1000;
      if (r.unit === 'MÎ©') return r.num * 1e6;
      return r.num;
    }
    function c2farad(c) {
      if (c.unit === 'pF') return c.num * 1e-12;
      if (c.unit === 'nF') return c.num * 1e-9;
      if (c.unit === 'Î¼F') return c.num * 1e-6;
      return c.num;
    }
    function t2sec(tx) {
      if (tx.unit === 'us') return tx.num * 1e-6;
      if (tx.unit === 'ms') return tx.num * 1e-3;
      if (tx.unit === 's') return tx.num;
      return tx.num;
    }
    let realR, realC, realT;
    const k = 1.1;
    if (t.num === null) {
      realR = r2ohm(R);
      realC = c2farad(C);
      realT = k * realR * realC;
    } else if (R.num === null) {
      realC = c2farad(C);
      realT = t2sec(t);
      realR = realT / (k * realC);
    } else if (C.num === null) {
      realR = r2ohm(R);
      realT = t2sec(t);
      realC = realT / (k * realR);
    }
    function autoR(r) {
      if (r < 1e3) return `${r.toFixed(3)} Î©`;
      if (r < 1e6) return `${(r/1e3).toFixed(3)} kÎ©`;
      return `${(r/1e6).toFixed(3)} MÎ©`;
    }
    function autoC(c) {
      if (c < 1e-9) return `${(c*1e12).toFixed(3)} pF`;
      if (c < 1e-6) return `${(c*1e9).toFixed(3)} nF`;
      return `${(c*1e6).toFixed(3)} Î¼F`;
    }
    function autoTime(tx) {
      if (tx < 1e-3) return `${(tx*1e6).toFixed(3)} Î¼s`;
      if (tx < 1) return `${(tx*1e3).toFixed(3)} ms`;
      return `${tx.toFixed(3)} s`;
    }
    const lines = [
      `R = ${autoR(realR)}`,
      `C = ${autoC(realC)}`,
      `t = ${autoTime(realT)}`
    ];
    res.textContent = lines.join('\n');
  }
  // ---------------------- è‰²ç¯ç”µé˜»è®¡ç®—é€»è¾‘ ----------------------
  const colorMap = [
    {name:'é»‘',color:'#000000',digit:0,multi:1, tol:null},
    {name:'æ£•',color:'#8B4513',digit:1,multi:10,tol:1},
    {name:'çº¢',color:'#FF0000',digit:2,multi:100,tol:2},
    {name:'æ©™',color:'#FFA500',digit:3,multi:1e3,tol:null},
    {name:'é»„',color:'#FFFF00',digit:4,multi:1e4,tol:null},
    {name:'ç»¿',color:'#008000',digit:5,multi:1e6,tol:0.5},
    {name:'è“',color:'#0000FF',digit:6,multi:1e7,tol:0.25},
    {name:'ç´«',color:'#800080',digit:7,multi:1e8,tol:0.1},
    {name:'ç°',color:'#808080',digit:8,multi:1e9,tol:0.05},
    {name:'ç™½',color:'#FFFFFF',digit:9,multi:1e10,tol:null},
    {name:'é‡‘',color:'#FFD700',digit:null,multi:0.1,tol:5},
    {name:'é“¶',color:'#C0C0C0',digit:null,multi:0.01,tol:10}
  ];
  let selectedColor = {
    b1:0,b2:0,b3:0,b4:10,
    b1_5:0,b2_5:0,b3_5:0,b4_5:1,b5_5:10
  };
  function renderBand(elId, allowIndex, targetKey) {
    const el = document.getElementById(elId);
    el.innerHTML = '';
    allowIndex.forEach(i => {
      const c = colorMap[i];
      const btn = document.createElement('div');
      btn.className = 'color-btn';
      btn.style.background = c.color;
      btn.title = c.name;
      btn.onclick = () => {
        el.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedColor[targetKey] = i;
      };
      if (selectedColor[targetKey] === i) btn.classList.add('active');
      el.appendChild(btn);
    });
  }
  function updateRingUI() {
    const type = document.getElementById('ring_type').value;
    document.getElementById('ring_4').style.display = type === '4' ? 'block' : 'none';
    document.getElementById('ring_5').style.display = type === '5' ? 'block' : 'none';
    if (type === '4') {
      renderBand('band1', [0,1,2,3,4,5,6,7,8,9], 'b1');
      renderBand('band2', [0,1,2,3,4,5,6,7,8,9], 'b2');
      renderBand('band3', [0,1,2,3,4,5,6,7,8,9,10,11], 'b3');
      renderBand('band4', [1,2,10,11], 'b4');
    } else {
      renderBand('band1_5', [0,1,2,3,4,5,6,7,8,9], 'b1_5');
      renderBand('band2_5', [0,1,2,3,4,5,6,7,8,9], 'b2_5');
      renderBand('band3_5', [0,1,2,3,4,5,6,7,8,9], 'b3_5');
      renderBand('band4_5', [0,1,2,3,4,5,6,7,8,9,10,11], 'b4_5');
      renderBand('band5_5', [1,2,5,6,7,10,11], 'b5_5');
    }
  }
  function calcResistorColor() {
    const type = document.getElementById('ring_type').value;
    const res = document.getElementById('resistor_color_res');
    let ohm, tol;
    if (type === '4') {
      const d1 = colorMap[selectedColor.b1].digit;
      const d2 = colorMap[selectedColor.b2].digit;
      const mul = colorMap[selectedColor.b3].multi;
      tol = colorMap[selectedColor.b4].tol;
      ohm = (d1 * 10 + d2) * mul;
    } else {
      const d1 = colorMap[selectedColor.b1_5].digit;
      const d2 = colorMap[selectedColor.b2_5].digit;
      const d3 = colorMap[selectedColor.b3_5].digit;
      const mul = colorMap[selectedColor.b4_5].multi;
      tol = colorMap[selectedColor.b5_5].tol;
      ohm = (d1 * 100 + d2 * 10 + d3) * mul;
    }
    let resistance = '';
    if (ohm >= 1e6) resistance = (ohm / 1e6).toFixed(3) + ' MÎ©';
    else if (ohm >= 1e3) resistance = (ohm / 1e3).toFixed(3) + ' kÎ©';
    else resistance = ohm.toFixed(3) + ' Î©';
    res.textContent = `é˜»å€¼ï¼š${resistance}\nè¯¯å·®ï¼šÂ±${tol}%`;
  }
  // ---------------------- çº¿å¾„æŸ¥è¯¢ï¼ˆ25â„ƒæ¸©å‡ï¼‰æ ¸å¿ƒé€»è¾‘ ----------------------
  const awgWireData = [
    {awg:0, diameter:8.251, current:105}, {awg:2, diameter:6.544, current:85},
    {awg:4, diameter:5.189, current:65}, {awg:6, diameter:4.115, current:50},
    {awg:8, diameter:3.264, current:40}, {awg:10, diameter:2.588, current:30},
    {awg:12, diameter:2.053, current:22}, {awg:14, diameter:1.628, current:15},
    {awg:16, diameter:1.291, current:10}, {awg:18, diameter:1.024, current:6},
    {awg:20, diameter:0.813, current:4}, {awg:22, diameter:0.644, current:2.5},
    {awg:24, diameter:0.511, current:1.5}, {awg:26, diameter:0.405, current:1.0},
    {awg:28, diameter:0.321, current:0.8}, {awg:30, diameter:0.255, current:0.5},
    {awg:32, diameter:0.202, current:0.3}, {awg:34, diameter:0.160, current:0.2},
    {awg:36, diameter:0.127, current:0.15}, {awg:38, diameter:0.101, current:0.1},
    {awg:40, diameter:0.080, current:0.08}
  ];
  function switchQueryType(type) {
    const wireBtn = document.getElementById('query_by_wire');
    const currentBtn = document.getElementById('query_by_current');
    const wire2cur = document.getElementById('wire_to_current');
    const cur2wire = document.getElementById('current_to_wire');
    if (type === 'wire') {
      wireBtn.classList.add('active');
      currentBtn.classList.remove('active');
      wire2cur.style.display = 'block';
      cur2wire.style.display = 'none';
    } else {
      currentBtn.classList.add('active');
      wireBtn.classList.remove('active');
      cur2wire.style.display = 'block';
      wire2cur.style.display = 'none';
    }
    document.getElementById('enamel_wire_res').textContent = '';
  }
  function switchWireInputType() {
    const type = document.getElementById('wire_input_type').value;
    const diaInput = document.getElementById('diameter_input');
    const awgInput = document.getElementById('awg_input');
    diaInput.style.display = type === 'diameter' ? 'block' : 'none';
    awgInput.style.display = type === 'awg' ? 'block' : 'none';
    document.getElementById('enamel_wire_res').textContent = '';
  }
  function awgToDiameter(awg) {
    const data = awgWireData.find(item => item.awg === awg);
    return data ? data.diameter : null;
  }
  function diameterToAwg(diameter) {
    return awgWireData.reduce((prev, curr) => {
      return Math.abs(curr.diameter - diameter) < Math.abs(prev.diameter - diameter) ? curr : prev;
    });
  }
  function calcWireToCurrent() {
    const res = document.getElementById('enamel_wire_res');
    const inputType = document.getElementById('wire_input_type').value;
    if (inputType === 'diameter') {
      const dia = parseFloat(document.getElementById('wire_diameter').value);
      if (!dia || dia <= 0 || dia > 10) {
        res.textContent = 'âš ï¸ è¯·è¾“å…¥0.08~10mmä¹‹é—´çš„æœ‰æ•ˆçº¿å¾„';
        return;
      }
      const matchData = diameterToAwg(dia);
      res.textContent = `åŒ¹é…ç»“æœï¼š
çº¿å¾„ï¼š${dia.toFixed(3)} mm
æœ€æ¥è¿‘AWGï¼š${matchData.awg} AWGï¼ˆå®é™…å¾„${matchData.diameter}mmï¼‰
25â„ƒæ¸©å‡æ‰¿è½½ç”µæµï¼š${matchData.current.toFixed(2)} A
æç¤ºï¼šç”µæµä¸ºç©ºæ°”ä¸­å•æ ¹æ•·è®¾å‚è€ƒå€¼`;
    } else {
      const awg = parseInt(document.getElementById('wire_awg').value);
      const matchData = awgWireData.find(item => item.awg === awg);
      if (!matchData) {
        res.textContent = 'âš ï¸ è¯·è¾“å…¥0~40ä¹‹é—´çš„æœ‰æ•ˆAWGçº¿è§„ï¼ˆæ•´æ•°ï¼‰';
        return;
      }
      res.textContent = `æŸ¥è¯¢ç»“æœï¼š
AWGçº¿è§„ï¼š${awg} AWG
å¯¹åº”æ¼†åŒ…çº¿å¾„ï¼š${matchData.diameter.toFixed(3)} mm
25â„ƒæ¸©å‡æ‰¿è½½ç”µæµï¼š${matchData.current.toFixed(2)} A
æç¤ºï¼šç”µæµä¸ºç©ºæ°”ä¸­å•æ ¹æ•·è®¾å‚è€ƒå€¼`;
    }
  }
  function calcCurrentToWire() {
    const res = document.getElementById('enamel_wire_res');
    const current = parseFloat(document.getElementById('work_current').value);
    if (!current || current < 0.08 || current > 105) {
      res.textContent = 'âš ï¸ è¯·è¾“å…¥0.08~105Aä¹‹é—´çš„æœ‰æ•ˆå·¥ä½œç”µæµ';
      return;
    }
    const suitableWires = awgWireData.filter(item => item.current >= current).sort((a,b) => a.awg - b.awg);
    const bestMatch = suitableWires[0] || awgWireData[awgWireData.length-1];
    const closeMatch = awgWireData.reduce((prev, curr) => {
      return Math.abs(curr.current - current) < Math.abs(prev.current - current) ? curr : prev;
    });
    res.textContent = `é€‚é…ç»“æœï¼š
æ¨èçº¿è§„ï¼ˆè½½æµé‡â‰¥å·¥ä½œç”µæµï¼‰ï¼š
${bestMatch.awg} AWG | çº¿å¾„${bestMatch.diameter.toFixed(3)}mm | æ‰¿è½½${bestMatch.current}A
æœ€æ¥è¿‘çº¿è§„ï¼ˆè½½æµé‡åŒ¹é…ï¼‰ï¼š
${closeMatch.awg} AWG | çº¿å¾„${closeMatch.diameter.toFixed(3)}mm | æ‰¿è½½${closeMatch.current}A
æç¤ºï¼šæ¨èè§„æ ¼æ›´å®‰å…¨ï¼Œé¿å…æ¸©å‡è¶…æ ‡`;
  }
  // åˆå§‹åŒ–é¡µé¢
  window.onload = function() {
    updateRingUI();
  }
</script>
